# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“‹ æ¶æ„è®¾è®¡

æœ¬é¡¹ç›®é‡‡ç”¨**åˆ†å±‚æ¶æ„è®¾è®¡**ï¼ŒèŒè´£æ¸…æ™°åˆ†ç¦»ï¼š

```
ä¸šåŠ¡é€»è¾‘å±‚ (core/)     â† çº¯ä¸šåŠ¡é€»è¾‘,æ— UIä»£ç 
      â†“
ç•Œé¢å±•ç¤ºå±‚ (vievs/)    â† UIç»„ä»¶(ä»…å­åŠŸèƒ½),è°ƒç”¨coreå±‚
      â†“
ä¸»çª—å£é›†æˆ (main.py)   â† ä¸»ç•Œé¢UIåˆ›å»º+æ¨¡å—ç»„åˆç®¡ç†
```

### æ ¸å¿ƒåŸåˆ™

1. **ä¸»ç•Œé¢** â†’ `main.py` ç›´æ¥åˆ›å»º,ä¸ä½¿ç”¨.uiæ–‡ä»¶ç»§æ‰¿
2. **ä¸šåŠ¡æ¨¡å—** â†’ `core/` ç›®å½•åˆ›å»º  
3. **å­åŠŸèƒ½UI** â†’ `vievs/` ç›®å½•å®ç°
4. **æ¨¡å—é›†æˆ** â†’ `main.py` çš„ `MainWindow.load_modules()` ç»„åˆåŠ è½½

## ğŸ“ ç›®å½•ç»“æ„

```
demo1/
â”œâ”€â”€ core/                      # ä¸šåŠ¡é€»è¾‘å±‚(çº¯é€»è¾‘,æ— UI)
â”‚   â”œâ”€â”€ __init__.py           # å¯¼å‡ºæ‰€æœ‰å¤„ç†å™¨
â”‚   â”œâ”€â”€ base.py               # ä¸šåŠ¡é€»è¾‘åŸºç±»
â”‚   â””â”€â”€ modules/              # ä¸šåŠ¡æ¨¡å—æ–‡ä»¶å¤¹
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ data_processor.py # æ•°æ®å¤„ç†å™¨
â”‚       â”œâ”€â”€ text_processor.py # æ–‡æœ¬å¤„ç†å™¨(ç¤ºä¾‹)
â”‚       â””â”€â”€ module_template.py# ä¸šåŠ¡é€»è¾‘æ¨¡æ¿
â”‚
â”œâ”€â”€ vievs/                     # ç•Œé¢å±•ç¤ºå±‚(UIç»„ä»¶,ä»…å­˜æ”¾å­åŠŸèƒ½UI)
â”‚   â”œâ”€â”€ __init__.py           # å¯¼å‡ºUIç»„ä»¶
â”‚   â”œâ”€â”€ base_view.py          # UIåŸºç±»
â”‚   â”œâ”€â”€ modules/              # åŠŸèƒ½æ¨¡å—æ–‡ä»¶å¤¹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ text_module/      # æ–‡æœ¬å¤„ç†UI(ç¤ºä¾‹)
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ text_module_ui.py
â”‚   â”‚   â””â”€â”€ image_module/     # å›¾åƒå¤„ç†UI(ç¤ºä¾‹)
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ image_module_ui.py
â”‚   â””â”€â”€ templates/            # UIæ¨¡æ¿æ–‡ä»¶å¤¹
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ ui_module_template.py # UIæ¨¡æ¿
â”‚
â”œâ”€â”€ qtmodern/                  # ç°ä»£åŒ–çª—å£æ ·å¼
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â”œâ”€â”€ frameless.qss     # çª—å£æ ·å¼(WindowsæŒ‰é’®é£æ ¼)
â”‚   â”‚   â””â”€â”€ style.qss         # ä¸»é¢˜æ ·å¼
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ _utils.py
â”‚   â”œâ”€â”€ styles.py             # ä¸»é¢˜å‡½æ•°(dark/light)
â”‚   â””â”€â”€ windows.py            # ç°ä»£åŒ–çª—å£(æ‹–åŠ¨ã€ç¼©æ”¾)
â”‚
â”œâ”€â”€ resources/                 # èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ icons/
â”‚
â””â”€â”€ main.py                    # ç¨‹åºå…¥å£(åŒ…å«ä¸»ç•Œé¢UIåˆ›å»º)
```


## æ ¸å¿ƒåŠŸèƒ½

### 1. çª—å£æ‹–åŠ¨å’Œç¼©æ”¾ âœ“
- **æ ‡é¢˜æ æ‹–åŠ¨**: ç‚¹å‡»æ ‡é¢˜æ æ‹–åŠ¨çª—å£ä½ç½®
- **è¾¹ç¼˜ç¼©æ”¾**: é¼ æ ‡ç§»åˆ°çª—å£è¾¹ç¼˜ï¼ˆ5pxçƒ­åŒºï¼‰å¯ä»¥æ‹–åŠ¨è°ƒæ•´å¤§å°
  - æ”¯æŒ8ä¸ªæ–¹å‘ï¼šä¸Šã€ä¸‹ã€å·¦ã€å³ã€å·¦ä¸Šã€å³ä¸Šã€å·¦ä¸‹ã€å³ä¸‹
  - é¼ æ ‡æ‚¬åœæ—¶è‡ªåŠ¨å˜æ¢å…‰æ ‡æ ·å¼
- **åŒå‡»æ ‡é¢˜æ **: æœ€å¤§åŒ–/è¿˜åŸçª—å£
- **Windowsé£æ ¼æŒ‰é’®**: 
  - æœ€å°åŒ–: â€”
  - æœ€å¤§åŒ–: â–¡
  - å…³é—­: âœ•

### 2. å®Œå–„çš„æ¡†æ¶ç»“æ„ âœ“

#### Coreå±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
```python
# æ·»åŠ æ–°çš„ä¸šåŠ¡é€»è¾‘
from core.base import BaseCore

class YourProcessor(BaseCore):
    def initialize(self):
        # åˆå§‹åŒ–é€»è¾‘
        pass
    
    def process(self, *args, **kwargs):
        # å¤„ç†é€»è¾‘
        pass
    
    def cleanup(self):
        # æ¸…ç†èµ„æº
        pass
```

#### Viewå±‚(ç•Œé¢)
```python
# åœ¨main.pyçš„MainWindowä¸­æ‰©å±•åŠŸèƒ½
class MainWindow(QMainWindow):
    def connect_signals(self):
        # è¿æ¥ä½ çš„ä¿¡å·æ§½
        self.your_button.clicked.connect(self.your_handler)
    
    def your_handler(self):
        # è°ƒç”¨æ ¸å¿ƒå¤„ç†å™¨
        result = self.data_processor.process()
```

### 3. ä½¿ç”¨æ–¹æ³•

#### è¿è¡Œç¨‹åº
```bash
python main.py
```

#### æ·»åŠ æ–°åŠŸèƒ½

**æ–¹å¼1ï¼šåœ¨coreä¸­æ·»åŠ ä¸šåŠ¡é€»è¾‘**
```python
# core/your_module.py
from .base import BaseCore

class YourModule(BaseCore):
    # å®ç°ä½ çš„åŠŸèƒ½
    pass

# åœ¨ core/__init__.py ä¸­å¯¼å‡º
from .your_module import YourModule
__all__ = ['BaseCore', 'DataProcessor', 'YourModule']
```

**æ–¹å¼2ï¼šåœ¨vievsä¸­æ·»åŠ ç•Œé¢åŠŸèƒ½**
```python
# vievs/modules/your_module/your_module_ui.py
from PySide6.QtWidgets import QWidget

class YourModuleUI(QWidget):
    def __init__(self, parent=None):
        super().__init__(parent)
        # å®ç°ä½ çš„UIåŠŸèƒ½

# åœ¨ main.py çš„ MainWindow.load_modules() ä¸­é›†æˆ
from vievs.modules.your_module import YourModuleUI

class MainWindow(QMainWindow):
    def load_modules(self):
        your_ui = YourModuleUI(self)
        self.add_module('åˆ†ç±»å', 'æ¨¡å—å', your_ui)
```

### 4. ä¸»é¢˜åˆ‡æ¢

åœ¨ `main.py` ä¸­ä¿®æ”¹ä¸»é¢˜ï¼š
```python
# æš—é»‘ä¸»é¢˜
qtmodern.styles.dark(app)

# æµ…è‰²ä¸»é¢˜
qtmodern.styles.light(app)
```

### 5. ç‰¹æ€§è¯´æ˜

- âœ… MVCæ¶æ„åˆ†ç¦»
- âœ… å¯æ‹–åŠ¨ã€å¯ç¼©æ”¾çš„æ— è¾¹æ¡†çª—å£
- âœ… Windowsé£æ ¼æŒ‰é’®
- âœ… ä¿æŒqtmodernæš—é»‘ä¸»é¢˜
- âœ… æ ¸å¿ƒé€»è¾‘ä¸ç•Œé¢åˆ†ç¦»
- âœ… æ–¹ä¾¿æ‰©å±•çš„åŸºç±»è®¾è®¡
- âœ… å®Œæ•´çš„ä¿¡å·æ§½æœºåˆ¶
- âœ… çŠ¶æ€æ å®æ—¶åé¦ˆ

# å¼€å‘å»ºè®®

1. **æ·»åŠ æ–°åŠŸèƒ½**: åœ¨ `core/` ç›®å½•åˆ›å»ºæ–°æ¨¡å—
2. **ä¿®æ”¹ç•Œé¢**: ç¼–è¾‘ `vievs/main.ui` ç„¶åé‡æ–°ç”Ÿæˆ
3. **ä¸šåŠ¡é€»è¾‘**: åœ¨ `vievs/main_window.py` ä¸­è°ƒç”¨coreæ¨¡å—
4. **æ ·å¼è°ƒæ•´**: ä¿®æ”¹ `qtmodern/resources/*.qss` æ–‡ä»¶

# å¿«é€Ÿå¼€å§‹ - æ·»åŠ æ–°æ¨¡å—

## ğŸ“˜ æ¨¡å—å¼€å‘æµç¨‹ï¼ˆé‡è¦ï¼ï¼‰

### æ­¥éª¤ 1ï¼šåœ¨ core/ åˆ›å»ºä¸šåŠ¡é€»è¾‘å¤„ç†å™¨

```python
# core/calculator_processor.py
from .base import BaseCore

class CalculatorProcessor(BaseCore):
    def __init__(self):
        super().__init__()
        self.result = None
    
    def initialize(self):
        self._initialized = True
        print("è®¡ç®—å™¨å¤„ç†å™¨å·²åˆå§‹åŒ–")
    
    def process(self, *args, **kwargs):
        # ä½ çš„ä¸šåŠ¡é€»è¾‘
        expression = args[0] if args else ""
        try:
            self.result = eval(expression)
            return True
        except:
            return False
    
    def get_result(self):
        return self.result
    
    def cleanup(self):
        self.result = None

# core/__init__.py ä¸­æ·»åŠ ï¼š
from .calculator_processor import CalculatorProcessor
__all__ = ['BaseCore', 'DataProcessor', 'TextProcessor', 'CalculatorProcessor']
```

### æ­¥éª¤ 2ï¼šåœ¨ vievs/ åˆ›å»ºUIæ¨¡å—

```python
# vievs/calculator_ui.py
from PySide6.QtWidgets import QWidget, QVBoxLayout, QLineEdit, QPushButton, QLabel

class CalculatorUI(QWidget):
    def __init__(self, parent=None, processor=None):
        super().__init__(parent)
        self.parent_window = parent
        self.processor = processor
        
        if self.processor:
            self.processor.initialize()
        
        self.init_ui()
    
    def init_ui(self):
        layout = QVBoxLayout(self)
        
        # æ˜¾ç¤ºå™¨
        self.display = QLineEdit()
        layout.addWidget(self.display)
        
        # è®¡ç®—æŒ‰é’®
        btn = QPushButton("è®¡ç®—")
        btn.clicked.connect(self.calculate)
        layout.addWidget(btn)
        
        # ç»“æœ
        self.result_label = QLabel("ç»“æœ: --")
        layout.addWidget(self.result_label)
    
    def calculate(self):
        if self.processor:
            success = self.processor.process(self.display.text())
            if success:
                result = self.processor.get_result()
                self.result_label.setText(f"ç»“æœ: {result}")
    
    def cleanup(self):
        if self.processor:
            self.processor.cleanup()
```

### æ­¥éª¤ 3ï¼šåœ¨ MainWindow ä¸­ç»„åˆ

```python
# main.py - MainWindow.load_modules()
def load_modules(self):
    # åŸæœ‰æ¨¡å—...
    
    # æ·»åŠ ä½ çš„æ–°æ¨¡å—
    from core import CalculatorProcessor
    from vievs.modules.calculator_ui import CalculatorUI
    
    calc_processor = CalculatorProcessor()
    calc_ui = CalculatorUI(self, calc_processor)
    self.add_module('è®¡ç®—å™¨åˆ†ç±»', 'è®¡ç®—å™¨', calc_ui)
```

å®Œæˆï¼è¿è¡Œç¨‹åºå°±èƒ½çœ‹åˆ°ä½ çš„æ–°æ¨¡å—äº†ã€‚

## ğŸ“š æ¨¡æ¿æ–‡ä»¶

- **`core/module_template.py`** - ä¸šåŠ¡é€»è¾‘æ¨¡æ¿ï¼Œå¤åˆ¶å®ƒæ¥åˆ›å»ºæ–°å¤„ç†å™¨
- **`vievs/ui_module_template.py`** - UIæ¨¡æ¿ï¼Œå¤åˆ¶å®ƒæ¥åˆ›å»ºUIæ¨¡å—

# âœ¨ ç¤ºä¾‹æ¨¡å—

è¿è¡Œç¨‹åºåï¼Œä½ ä¼šçœ‹åˆ°"ğŸ“ æ–‡æœ¬å¤„ç†"æ¨¡å—ï¼Œå±•ç¤ºäº†ï¼š
- coreå±‚ï¼š`core/modules/text_processor.py` - æ–‡æœ¬å¤„ç†é€»è¾‘
- UIå±‚ï¼š`vievs/modules/text_module/text_module_ui.py` - æ–‡æœ¬å¤„ç†ç•Œé¢
- ç»„åˆï¼š`main.py` çš„ `MainWindow.load_modules()` - å°†ä¸¤è€…ç»„åˆ

### æ¨¡å—ç®¡ç†API

åœ¨ `MainWindow` ä¸­å¯ç”¨çš„æ–¹æ³•ï¼š

```python
# æ·»åŠ æ¨¡å—
self.add_module(
    module_name='my_module',    # æ¨¡å—å”¯ä¸€æ ‡è¯†
    module_widget=widget,        # æ¨¡å—æ§ä»¶
    tab_name='æˆ‘çš„æ¨¡å—',         # æ ‡ç­¾é¡µæ˜¾ç¤ºåç§°
    tab_index=0                  # å¯é€‰ï¼šæ’å…¥ä½ç½®ï¼ˆ0=ç¬¬ä¸€ä¸ªï¼‰
)

# è·å–æ¨¡å—å¼•ç”¨
module = self.get_module('my_module')
if module:
    module.some_method()  # è°ƒç”¨æ¨¡å—æ–¹æ³•

# ï¼ˆå¯é€‰ï¼‰ç§»é™¤æ¨¡å—ï¼šå¯ä»¥åœ¨ MainWindow ä¸­å®ç° remove_module() åè°ƒç”¨
# self.remove_module('my_module')

# è®¿é—®æ‰€æœ‰æ¨¡å—
for name, module in self.modules.items():
    print(f"æ¨¡å—: {name}")
```

### æ¨¡å—å¼€å‘æœ€ä½³å®è·µ

1. **ç»§æ‰¿QWidget**: æ‰€æœ‰æ¨¡å—éƒ½åº”è¯¥ç»§æ‰¿è‡ª `QWidget`
2. **æ¥æ”¶çˆ¶çª—å£**: åœ¨ `__init__` ä¸­æ¥æ”¶ `parent` å‚æ•°
3. **åˆ†ç¦»UIå’Œé€»è¾‘**: 
   - `init_ui()` - åˆ›å»ºç•Œé¢
   - `connect_signals()` - è¿æ¥ä¿¡å·æ§½
   - ä¸šåŠ¡é€»è¾‘æ–¹æ³•å•ç‹¬å®ç°
4. **ä½¿ç”¨ä¿¡å·**: å®šä¹‰è‡ªå®šä¹‰ä¿¡å·ç”¨äºæ¨¡å—é—´é€šä¿¡
5. **æ•°æ®æŒä¹…åŒ–**: å®ç° `get_data()` å’Œ `set_data()` æ–¹æ³•
6. **è®¿é—®æ ¸å¿ƒ**: é€šè¿‡ `self.parent_window.data_processor` è®¿é—®æ ¸å¿ƒå¤„ç†å™¨

### æ–‡ä»¶è¯´æ˜

- **`core/modules/module_template.py`**: ä¸šåŠ¡é€»è¾‘æ¨¡æ¿ï¼ŒåŒ…å«è¯¦ç»†æ³¨é‡Šå’Œä½¿ç”¨è¯´æ˜
- **`vievs/templates/ui_module_template.py`**: UIæ¨¡å—æ¨¡æ¿ï¼ˆæ¨èä»è¿™é‡Œå¤åˆ¶åˆ›å»ºæ–°UIæ¨¡å—ï¼‰
- **`core/modules/text_processor.py` + `vievs/modules/text_module/text_module_ui.py`**: å®Œæ•´ç¤ºä¾‹æ¨¡å—ï¼ˆæ–‡æœ¬å¤„ç†ï¼‰ï¼Œå±•ç¤ºcore+UIåˆ†å±‚å’Œæ¨¡å—é›†æˆ
- **`main.py` ä¸­çš„ `MainWindow`**: ä¸»çª—å£ç±»ï¼ŒåŒ…å«æ¨¡å—ç®¡ç†ç³»ç»Ÿï¼ˆadd_module / add_category / load_modulesï¼‰

### æ¨¡å—é—´é€šä¿¡

```python
# æ¨¡å—Aå‘é€ä¿¡å·
class ModuleA(QWidget):
    data_ready = Signal(str)
    
    def process(self):
        self.data_ready.emit("å¤„ç†å®Œæˆçš„æ•°æ®")

# æ¨¡å—Bæ¥æ”¶ä¿¡å·
class ModuleB(QWidget):
    def __init__(self, parent=None):
        super().__init__(parent)
        # è¿æ¥æ¨¡å—Açš„ä¿¡å·
        module_a = parent.get_module('module_a')
        if module_a:
            module_a.data_ready.connect(self.on_data_received)
    
    def on_data_received(self, data):
        print(f"æ”¶åˆ°æ•°æ®: {data}")
```

---
Author: Byxs20
Version: 1.0.5
